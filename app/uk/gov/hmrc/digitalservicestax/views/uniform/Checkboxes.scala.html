@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@this(
        standard_field: StandardField,
        govukCheckboxes: GovukCheckboxes
)


@(key: List[String], options: Seq[String], existing: Set[String], errors: ErrorTree, messages: UniformMessages[Html], conditional: PartialFunction[String,Html] = PartialFunction.empty )(implicit messagesDupe: UniformMessages[Html], request: Request[AnyContent])

@keyNoDots=@{key.mkString("-")}
@inlineCheckboxKeys=@{(key.mkString(".") == "loan-amount.estimate")}
@errMessage=@{
    errors.valueAtRootList.headOption.map { error =>
        ErrorMessage(
            content = HtmlContent(error.prefixWith(key).render(messages))
        )
    }
}

@standard_field(key, errors, "checkboxes", messages, false) {

    @govukCheckboxes(Checkboxes(
        fieldset = Some(Fieldset(
            legend = Some(Legend(
                content = HtmlContent(messages(s"${key.head}.heading")),
                classes = "govuk-fieldset__legend--xl",
                isPageHeading = true
            ))
        )),
        errorMessage = errMessage,
        hint = Some(Hint(
            content = HtmlContent(messages(s"${key.head}.hint"))
        )),
        idPrefix = Some(s"$keyNoDots"),
        name = key.mkString("."),
        items =
            for((opt,num) <- if(key.head == "about-loan"){options.reverse.zipWithIndex} else {options.zipWithIndex}) yield {
                CheckboxItem(
                    id = Some(s"$keyNoDots-$num"),
                    content = HtmlContent(messages.decompose({key :+ opt}.mkString("."))),
                    value = opt,
                    checked = existing.exists(_.toUpperCase == opt.toUpperCase())
                )
            }
        )
    )

@*<div class="checkboxes@if(inlineCheckboxKeys){--inline}">*@
  @*@for((opt,num) <- if(key.head == "about-loan"){options.reverse.zipWithIndex} else {options.zipWithIndex}) {*@
    @*<div class="checkboxes__item multiple-choice" data-target="@keyNoDots-@opt">*@

      @*<input*@
        @*class="checkboxes__input"*@
        @*id="@keyNoDots-@num"*@
        @*name="@{key.mkString(".")}"*@
        @*type="checkbox"*@
        @*value="@opt"*@
        @*@if(existing.exists(_.toUpperCase == opt.toUpperCase())){ checked }*@
      @*>*@
      @*<label class="label checkboxes__label form-label" for="@keyNoDots-@num">*@
        @*<span>@messages.decompose({key :+ opt}.mkString("."))</span>*@
        @*@messages.get({key :+ opt :+ "hint"}.mkString(".")).map { hint =>*@
          @*<span id="@keyNoDots-@opt-item-hint" class="form-hint checkboxes__hint">*@
            @*@hint*@
          @*</span>*@
      @*}*@
      @*</label>*@
    @*</div>*@

    @*@if(conditional.isDefinedAt(opt)) {*@
      @*<div id="@keyNoDots-@opt" class="checkboxes__conditional panel panel-border-narrow js-hidden">*@
        @*@conditional(opt)*@
      @*</div>*@
    @*}*@
  @*}*@
  @*</div>*@
}
